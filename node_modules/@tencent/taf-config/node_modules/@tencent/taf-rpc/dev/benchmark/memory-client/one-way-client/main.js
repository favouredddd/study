var Taf  = require("../../../../protal.js").client;
var TRom = require("./NodeTafProxy").TRom;

var fs = require('fs');
var logStream = fs.createWriteStream('log.txt', {'flags': 'a'});


//使用配置文件初始化通信器
Taf.initialize("./config.conf");

//生成代理类
var prx = Taf.stringToProxy(TRom.NodeTafProxy, Taf.configure.get("main.LocalServer"));      //客户端和服务端都部署在本地。客户端直连本地服务

//生成回调类
var success = function (result) {

}

var error = function (result) {

}
setInterval(function(){
        prx.getUsrName("one_way_czzou",{packetType:1}).then(success, error).done();
},100);
setInterval(logMemoryUse,2500);

function logMemoryUse(){
    var rss=process.memoryUsage().rss;
    var heapTotal=process.memoryUsage().heapTotal;
    var heapUsed=process.memoryUsage().heapUsed;
    console.log(process.uptime(),"rss:",(rss/1024/1024).toFixed(5),"M");
    console.log(process.uptime(),"heapTotal:",(heapTotal/1024/1024).toFixed(5),"M");
    console.log(process.uptime(),"heap:",(heapUsed/1024/1024).toFixed(5),"M");
    console.log("            ");
    logStream.write((heapUsed/1024/1024).toFixed(5)+"\r\n");
}
