process.env.taf_rpc_path = "../../../../";
process.env.taf_stream   = "../../../../../taf-stream";

var net = require("net");
var TRom = require("./NodeJsCommJce.js").TRom;
var Taf  = require(process.env.taf_stream);

var socket = new net.Socket();
socket.connect(14002, "127.0.0.1");

socket.on("connect", function () {
    var wup = new Taf.Wup();
    wup.wupVersion  = Taf.Wup.WUP_COMPLEX;
    wup.servantName = "testnode";
    wup.funcName    = "getUsrName";

    wup.writeString("sUsrName", "Tex_SUSERNAME");
    wup.writeString("sValue1",  "Tex0000001");
    wup.writeString("sValue2",  "Tex2");

    var buf = wup.encode();

    socket.write(buf.toNodeBuffer());
});

socket.on("data", function(data) {
    var wup = new Taf.Wup();
    wup.decode(new Taf.BinBuffer(new Buffer(data)));

    var code = wup.getTafResultCode();
    var msg  = wup.getTafResultDesc();
    console.log("code:", code, msg);

    if (code == 0) {
        console.log("return:", wup.readInt32(""));
        console.log("sValue1:", wup.readString("sValue1"));
        console.log("sValue2:", wup.readString("sValue2"));
    }
});

socket.on("close", function() {

});

socket.on("error", function() {

});
