/**
 * Created by czzou on 2016/12/16.
 */
var tafNode=require("./TafNodeTestServerProxy").TafNode;
var rpcClient=require('@tencent/taf-rpc').client;

var servant = "TRom.TafNodeTestServer.TafNodeTestObj";
if (!process.env.TAF_CONFIG) {
    //servant += "@tcp -h 10.224.140.218 -p 8080  -t 60000";
    servant += "@tcp -h 127.0.0.1 -p 14009  -t 60000";
}
var prx = rpcClient.stringToProxy(tafNode.TafNodeTestProxy, servant);

exports.getServerInfo=function(){
    var stReq=new tafNode.TafNodeTestReq();
    stReq.readFromObject({
        pid:process.pid+""
    });
    return prx.getServerInfo(stReq).then(function(stRsp){
        var response=stRsp.response;
        if(response.return!=0){
            throw response;
        }
        return response.arguments.stRsp;
    });
}
exports.getServerInfo_hash=function(){
    var stReq=new tafNode.TafNodeTestReq();
    stReq.readFromObject({
        pid:process.pid+""
    });
    return prx.getServerInfo(stReq,{hashCode:1}).then(function(stRsp){
        var response=stRsp.response;
        if(response.return!=0){
            throw response;
        }
        return response.arguments.stRsp;
    });
}
exports.getServerInfo_oneway=function(){
    var stReq=new tafNode.TafNodeTestReq();
    stReq.readFromObject({
        pid:process.pid+""
    });
    return prx.getServerInfo(stReq,{packetType:1}).then(function(stRsp){
        var response=stRsp.response;
        if(response.return!=0){
            throw response;
        }
        return response.arguments.stRsp;
    });
}