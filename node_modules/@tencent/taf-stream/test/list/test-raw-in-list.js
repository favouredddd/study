var Taf    = require("../../libjce.js");

var os;
describe("test raw in list", function() {

	beforeEach(function() {
		os  = new Taf.JceOutputStream();
	});

	it("#test for list<string>", function (){
		var listValue = new Taf.List(Taf.String, 1);
		listValue.push(Buffer.from("str1"));
		listValue.push(Buffer.from("str2"));

		os.writeList(0,listValue);
		var is  = new Taf.JceInputStream(os.getBinBuffer());

		var decodeList = is.readList(0, true, Taf.List(Taf.String, 1));
		decodeList.length.should.equal(2);
		(decodeList.at(0) instanceof Buffer).should.be.true();
		(decodeList.at(1) instanceof Buffer).should.be.true();

		decodeList.at(0).toString().should.equal("str1");
		decodeList.at(1).toString().should.equal("str2");
	});

	it("#test for list<string> old way(by bRaw)", function (){
		var listValue = new Taf.List(Taf.String);
		listValue.push(Buffer.from("str1"));
		listValue.push(Buffer.from("str2"));

		os.writeList(0,listValue, true);
		var is  = new Taf.JceInputStream(os.getBinBuffer());

		var decodeList = is.readList(0, true, Taf.List(Taf.String), true);
		decodeList.length.should.equal(2);
		(decodeList.at(0) instanceof Buffer).should.be.true();
		(decodeList.at(1) instanceof Buffer).should.be.true();

		decodeList.at(0).toString().should.equal("str1");
		decodeList.at(1).toString().should.equal("str2");

	});

	it("#test for list<list<string>", function (){
		var listValue = new Taf.List(Taf.List(Taf.String, 1));

		var value = new Taf.List(Taf.String, 1);
		value.push(Buffer.from("str1"));
		value.push(Buffer.from("str2"));

		listValue.push(value);


		os.writeList(0,listValue);
		var is  = new Taf.JceInputStream(os.getBinBuffer());

		var decodeList = is.readList(0, true, Taf.List(Taf.List(Taf.String, 1)));

		var decodeValue = decodeList.at(0);
		decodeValue.length.should.equal(2);
		(decodeValue.at(0) instanceof Buffer).should.be.true();
		(decodeValue.at(1) instanceof Buffer).should.be.true();

		decodeValue.at(0).toString().should.equal("str1");
		decodeValue.at(1).toString().should.equal("str2");

	});


});




